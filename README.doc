

# azure login
azure login

# list out subsciptions
azure account list

# set subscription
azure account set <subscirption/orgid>

# create a RG
azure group create <name> <region>

## deploy the applicaiton gateway
azure group deployment create  -f arm/appgateway.json -e arm/appgatewayparams.json gatewa-test ag-deploy1
 
 ## logs of the deployment
 azure group log show "gatewa-test" --last-deployment
 
 
 ## gatwway configuration
 Nees to be done with PowerShell :(((
Login-AureRmAccount
get-AzureRmSubscription
New-AzureRmResourceGroup -Name "AppGWTest"
$subnet = New-AzureRmVirtualNetworkSubnetConfig -Name subnet01 -AddressPrefix 10.0.0.0/24
 
$gipconfig = New-AzureRmApplicationGatewayIPConfiguration -Name gatewayIP01 -Subnet $subnet 
$pool = New-AzureRmApplicationGatewayBackendAddressPool -Name pool01 -BackendIPAddresses 134.170.185.46, 134.170.188.221,134.170.185.50
$poolSetting = New-AzureRmApplicationGatewayBackendHttpSettings -Name poolsetting01 -Port 80 -Protocol Http -CookieBasedAffinity Enabled
$fp = New-AzureRmApplicationGatewayFrontendPort -Name frontendport01  -Port 443
$cert = New-AzureRmApplicationGatewaySslCertificate -Name cert01 -CertificateFile <full path for certificate file> -Password ‘<password>’
$fipconfig = New-AzureRmApplicationGatewayFrontendIPConfig -Name fipconfig01 -PublicIPAddress $publicip
$listener = New-AzureRmApplicationGatewayHttpListener -Name listener01  -Protocol Https -FrontendIPConfiguration $fipconfig -FrontendPort $fp -SslCertificate $cert
$rule = New-AzureRmApplicationGatewayRequestRoutingRule -Name rule01 -RuleType Basic -BackendHttpSettings $poolSetting -HttpListener $listener -BackendAddressPool $pool
$sku = New-AzureRmApplicationGatewaySku -Name Standard_Small -Tier Standard -Capacity 2
$appgw = New-AzureRmApplicationGateway -Name appgwtest -ResourceGroupName appgw-rg -Location "West US" -BackendAddressPools $pool -BackendHttpSettingsCollection $poolSetting -FrontendIpConfigurations $fipconfig  -GatewayIpConfigurations $gipconfig -FrontendPorts $fp -HttpListeners $listener -RequestRoutingRules $rule -Sku $sku -SslCertificates $cert
 

 
 ------------------
## gateway deployment errors
Public IP Address referenced by Application Gateway FrontendIpConfiguration cannot have Domain Name Label specified. 
  # resolution: remove : "dnsSettings": { "domainNameLabel": "[variables('publicIPAddressName2')]"}
The domain name label AppGWTestVIP01 is invalid. It must conform to the following regular expression: ^[a-z][a-z0-9-]{1,61}[a-z0-9]
  # resolution: remove upper characters from domainNameLabel
Two Frontend Ports of Application Gateway are using the same port number 443.
Two Http Listeners of Application Gateway are using the same Frontend Port 
Application Gateway cannot have more than one FrontendIPConfigurations using Public IP:
    resolution: 